<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Calendario</title>
        
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <!--<link href="css/bootstrap-glyphicons.css" rel="stylesheet" media="screen">-->
        <link href="css/calendario.css" rel="stylesheet">
    </head>

    <body>
        
        <div class="container">            
            <!--            
            <div id="calendario" class="row">
                <div class="row calendario-encabezado">
                    <div class="col-xs-1"></div>
                    
                    <div class="col-xs-10">
                        <div class="row calendario-semana">
                            <div class="col-xs-1 calendario-dia-encabezado"></div>
                            <div class="col-xs-1 calendario-dia-encabezado"></div>
                            <div class="col-xs-1 calendario-dia-encabezado"></div>
                            <div class="col-xs-1 calendario-dia-encabezado"></div>
                            <div class="col-xs-1 calendario-dia-encabezado"></div>
                            <div class="col-xs-1 calendario-dia-encabezado"></div>
                            <div class="col-xs-1 calendario-dia-encabezado"></div>
                        </div>
                    </div>
                    
                </div>

                <div class="row">
                    <div class="col-xs-1"></div>
                    
                    <div class="col-xs-10">
                        <div class="row calendario-semana">
                            <div month="2" day="4" class="col-xs-1 calendario-dia calendario-dia-fuera-mes">
                                <div>4</div>
                            </div>
                            <div month="2" day="5" class="col-xs-1 calendario-dia calendario-dia-fuera-mes">
                                <div>5</div>
                            </div>
                            <div month="3" day="6" class="col-xs-1 calendario-dia">
                                <div>6</div>
                            </div>
                            <div month="3" day="7" class="col-xs-1 calendario-dia calendario-dia-hoy">
                                <div>7</div>
                                <a href="#1">
                                    <span dayTo="10" monthTo="4" size="grande" style="width: 450%" data-toggle="tooltip" data-placement="left" title="Torneo" class="calendario-evento" tipo="torneo">
                                        <fecha inicio="true">20:17</fecha><div style="width: 358%"><contenido inicio="true">Torneoooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo</contenido></div>
                                    </span>
                                </a>
                                <a href="#2"><span data-toggle="tooltip" data-placement="left" title="Evento" class="calendario-evento" tipo="evento"><fecha>20:17</fecha><contenido>Evento</contenido></span></a>
                                <a href="#3"><span data-toggle="tooltip" data-placement="left" title="Amistoso" class="calendario-evento" tipo="amistoso"><fecha>20:17</fecha><contenido>Amistoso</contenido></span></a>
                                <a href="#4"><span data-toggle="tooltip" data-placement="left" title="Entrenamiento" class="calendario-evento" tipo="entrenamiento"><fecha>20:17</fecha><contenido>Entrenamiento</contenido></span></a>
                                <a href="#5"><span data-toggle="tooltip" data-placement="left" title="Entrenamiento" class="calendario-evento" tipo="entrenamiento"><fecha>20:17</fecha><contenido>Entrenamiento</contenido></span></a>
                                <a href="#6"><span data-toggle="tooltip" data-placement="left" title="Entrenamiento" class="calendario-evento" tipo="entrenamiento"><fecha>20:17</fecha><contenido>Entrenamiento</contenido></span></a>
                                <a href="#7"><span data-toggle="tooltip" data-placement="left" title="Entrenamiento" class="calendario-evento" tipo="entrenamiento"><fecha>20:17</fecha><contenido>Entrenamiento</contenido></span></a>
                            </div>
                            <div month="3" day="8" class="col-xs-1 calendario-dia">
                                <div>8</div>
                                <a href="#1"><span fecha="07/04" ofDay="7" ofMonth="4" class="calendario-evento" tipo="torneo"><fecha>07/04</fecha><contenido>Torneoooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo</contenido></span></a>
                                <a href="#8"><span data-toggle="tooltip" data-placement="left" title="Amistoso" class="calendario-evento" tipo="amistoso"><fecha>20:17</fecha><contenido>Amistoso</contenido></span></a>
                            </div>
                            <div month="3" day="9" class="col-xs-1 calendario-dia">
                                <div>9</div>
                                <a href="#1"><span fecha="07/04" ofDay="7" ofMonth="4" class="calendario-evento" tipo="torneo"><fecha>07/04</fecha><contenido>Torneoooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo</contenido></span></a>
                            </div>
                            <div month="3" day="10" class="col-xs-1 calendario-dia">
                                <div>10</div>
                                <a href="#1"><span fecha="07/04" ofDay="7" ofMonth="4" class="calendario-evento" tipo="torneo"><fecha>07/04</fecha><contenido>Torneoooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo</contenido></span></a>
                            </div>
                        </div>
                        <div class="row calendario-semana">
                            <div month="3" day="11" class="col-xs-1 calendario-dia">
                                <div>11</div>
                                <a href="#1">
                                    <span data-toggle="tooltip" data-placement="left" title="Torneo" class="calendario-evento" ofDay="7" ofMonth="4" dayTo="11" monthTo="4" tipo="torneo">
                                        <fecha inicio="true">07/04</fecha><contenido inicio="true">Torneoooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo</contenido>
                                    </span>
                                </a>                                
                            </div>
                            <div month="3" day="12" class="col-xs-1 calendario-dia">
                                <div>12</div>
                            </div>
                            <div month="3" day="13" class="col-xs-1 calendario-dia">
                                <div>13</div>
                            </div>
                            <div month="3" day="14" class="col-xs-1 calendario-dia">
                                <div>14</div>
                            </div>
                            <div month="3" day="15" class="col-xs-1 calendario-dia">
                                <div>15</div>
                            </div>
                            <div month="3" day="16" class="col-xs-1 calendario-dia">
                                <div>16</div>
                            </div>
                            <div month="3" day="17" class="col-xs-1 calendario-dia">
                                <div>17</div>
                            </div>
                        </div>
                    </div>
                    
                </div>

            </div>
            <a id="back-to-top" href="#" class="btn btn-primary btn-lg back-to-top" role="button" title="Click para ir hacia arriba" data-toggle="tooltip" data-placement="left"><span class="glyphicon glyphicon-chevron-up"></span></a>
             -->
        </div>

        <script src="js/jquery.min.js"></script>
        <script src="js/bootstrap.min.js"></script>

        <script type="text/javascript">
            $(document).ready(function () {
                // Scroll Top //
                $('[data-toggle="tooltip"]').tooltip();

                $(window).scroll(function () {
                    if ($(this).scrollTop() > 50) {
                        $('#back-to-top').fadeIn();
                    } else {
                        $('#back-to-top').fadeOut();
                    }
                });

                $('#back-to-top').click(function () {
                    $('#back-to-top').tooltip('hide');
                    $('body,html').animate({
                        scrollTop: 0
                    }, 800);
                    return false;
                });

                $('#back-to-top').tooltip('show');
                /////////////////

                var LUNES     = 1;
                var MARTES    = 2;
                var MIERCOLES = 3;
                var JUEVES    = 4;
                var VIERNES   = 5;
                var SABADO    = 6;
                var DOMINGO   = 7;

                var ENERO     = 1;
                var FEBRERO   = 2;
                var MARZO     = 3;
                var ABRIL     = 4;
                var DICIEMBRE = 12;

                var SEMANAS_MES = 6; // Numero de semanas a mostrar en un determinado mes del calendario

                var iZonaHoraria = (new Date().getTimezoneOffset());

                var iAnioActual  = (new Date().getUTCFullYear());
                var iMesActual   = (new Date().getUTCMonth()) + 1;
                var iDiaActual   = (new Date().getUTCDate());
                var aDiasMeses   = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
                var aDiasSemana  = [7, 1, 2, 3, 4, 5, 6];

                var iMesSeleccionado = iMesActual;

                var aDiasCalendario = [];

                // Calendario //
                /*
                    selector -> selector en donde crear el calendario
                */
                function crearCalendario(sSelector) {
                    $(sSelector).append($('<div id="calendario" class="row"></div>'));
                }

                /*
                    iMes  -> numero de mes (1-12)
                    iAnio -> anio a comprobar
                */
                function diasMes(iMes, iAnio = iAnioActual) {
                    if (iMes > 12) { iMes = 1;  }
                    if (iMes < 1)  { iMes = 12; }

                    let iDias = aDiasMeses[iMes - 1];

                    if (iMes == FEBRERO && esAnioBisiesto(iAnio)) {
                        iDias++;    
                    }

                    return iDias;
                }

                function esAnioBisiesto(iAnio = iAnioActual) {
                    return ((iAnio % 4 == 0) && ((iAnio % 100 != 0) || (iAnio % 400 == 0)));
                }

                /*
                    Genera el encabezado con los dias de la semana
                */
                function generarEncabezado() {
                    var row     = $('<div class="row calendario-encabezado"></div>');
                    var espacio = $('<div class="col-xs-1"></div>');

                    var colDias   = $('<div class="col-xs-10"></div>');
                    var rowSemana = $('<div class="row calendario-semana"></div>');

                    for (let d = 0; d < 7; d++) {
                        let colDiaSemana = $('<div class="col-xs-1 calendario-dia-encabezado"></div>');
                        rowSemana.append(colDiaSemana);
                    }

                    colDias.append(rowSemana);
                    
                    row.append(espacio);
                    row.append(colDias);

                    $('#calendario').append(row);
                }

                /*
                    
                */
                function generarSemanaMes(iDia, iMes, bAnteriorMes = false, bPosteriorMes = false) {
                    if (iMes > 12) { iMes = 1;  }
                    if (iMes < 1)  { iMes = 12; }

                    var colDia = $('<div month="'+iMes+'" day="'+iDia+'" class="col-xs-1 calendario-dia"></div>');
                    var divDia = $('<div>'+iDia+'</div>');

                    if (iMes == iMesActual && iDia == iDiaActual) {
                        colDia.addClass('calendario-dia-hoy');
                    }
                    
                    if (bAnteriorMes || bPosteriorMes) {
                        colDia.addClass('calendario-dia-fuera-mes');
                    }

                    colDia.append(divDia);
                                    
                    return colDia;
                }

                /*
                    Devuelve el dia de la semana de un determinado mes y anio.
                */
                function xDiaMesDiaSemana(iMes = iMesSeleccionado, iAnio = iAnioActual, iDia = 1) {
                    var sDate      = iAnio + '-' + iMes + '-' + iDia;
                    var iDiaSemana = (new Date(sDate).getUTCDay());

                    return aDiasSemana[iDiaSemana];
                }

                /*
                    Genera los dias del calendario de un determinado mes y anio.

                    El maximo de semanas que aparecen en el calendario se encuentra
                    en la constante SEMANAS_MES.

                    Devuelve un array.
                */
                function generarDiasCalendario(iMes = iMesSeleccionado, iAnio = iAnioActual) {
                    var iDiasMesCalendario = diasMes(iMes, iAnioActual);

                    var iPrimerDiaSemanaMes = xDiaMesDiaSemana(iMes, iAnio);
                    var iUltimoDiaSemanaMes = xDiaMesDiaSemana(iMes, iAnio, iDiasMesCalendario);

                    var iNumeroDiasAnterioresMes  = 0;
                    var iNumeroDiasPosterioresMes = 0;

                    var iMesAnterior  = iMes - 1;
                    var iMesPosterior = iMes + 1;

                    var iAnioAnterior  = iAnio - 1;
                    var iAnioPosterior = iAnio + 1;

                    var iDiasMesAnterior  = 0;
                    var iDiasMesPosterior = 0;

                    if (iPrimerDiaSemanaMes > LUNES) {
                        iNumeroDiasAnterioresMes = iPrimerDiaSemanaMes - LUNES;
                    }

                    if (iUltimoDiaSemanaMes < DOMINGO) {
                        iNumeroDiasPosterioresMes = DOMINGO - iUltimoDiaSemanaMes;
                    }

                    if (iNumeroDiasAnterioresMes > 0) {
                        let iTempAnio = iAnio;

                        if (iMesAnterior < ENERO) {
                            iTempAnio = iAnioAnterior;
                        }

                        iDiasMesAnterior = diasMes(iMesAnterior, iAnioAnterior);
                    }

                    if (iNumeroDiasPosterioresMes > 0) {
                        let iTempAnio = iAnio;

                        if (iMesPosterior > DICIEMBRE) {
                            iTempAnio = iAnioPosterior;
                        }

                        iDiasMesPosterior = diasMes(iMesPosterior, iAnioPosterior);                    
                    }

                    var row       = $('<div class="row">');
                    var espacio   = $('<div class="col-xs-1"></div>');
                    var colSemana = $('<div class="col-xs-10"></div>');

                    var rowSemana;

                    var contDia = 1;

                    for (let d = iNumeroDiasAnterioresMes - 1; d >= 0; d--) {
                        let iDia = iDiasMesAnterior - d;

                        if ((contDia == 1) || ((contDia - 1) % 7 == 0)) {
                            rowSemana = $('<div class="row calendario-semana"></div>');
                            colSemana.append(rowSemana);
                        }

                        rowSemana.append(generarSemanaMes(iDia, iMes - 1, true));

                        contDia++;
                        aDiasCalendario.push(iDia);
                    }

                    for (let d = 1; d <= iDiasMesCalendario; d++) {                        
                        if ((contDia == 1) || ((contDia - 1) % 7 == 0)) {
                            rowSemana = $('<div class="row calendario-semana"></div>');
                            colSemana.append(rowSemana);
                        }

                        rowSemana.append(generarSemanaMes(d, iMes));

                        contDia++;
                        aDiasCalendario.push(d);
                    }

                    for (let d = 1; d <= iNumeroDiasPosterioresMes; d++) {
                        if ((contDia == 1) || ((contDia - 1) % 7 == 0)) {
                            rowSemana = $('<div class="row calendario-semana"></div>');
                            colSemana.append(rowSemana);
                        }

                        rowSemana.append(generarSemanaMes(d, iMes, false, true));

                        contDia++;
                        aDiasCalendario.push(d);
                    }
                    
                    var bMenorDeMaximoSemanas = ((aDiasCalendario.length / 7) < SEMANAS_MES);
                    
                    if (bMenorDeMaximoSemanas) {
                        for (let d = iNumeroDiasPosterioresMes + 1; d <= (7 + (iNumeroDiasPosterioresMes)); d++) {
                            if ((contDia == 1) || ((contDia - 1) % 7  == 0)) {
                                rowSemana = $('<div class="row calendario-semana"></div>');
                                colSemana.append(rowSemana);
                            }

                            rowSemana.append(generarSemanaMes(d, iMes + 1, false, true));

                            contDia++;
                            aDiasCalendario.push(d);
                        }
                    }

                    row.append(espacio);
                    row.append(colSemana);

                    $('#calendario').append(row);

                    return aDiasCalendario;
                }

                //console.log(generarDiasCalendario().toString());
                //console.log(iZonaHoraria);

                crearCalendario('.container');
                generarEncabezado();
                generarDiasCalendario();

                ////////////////


            });        
        </script>

    </body>

</html>